<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ø£Ø³Ù…Ø§Ùƒ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ â€” Ù…Ù†ÙŠÙˆ</title>
<style>
  /* --- ØµÙØ­Ø© Ø£Ù†ÙŠÙ‚Ø© Ù„Ù„ÙƒØªØ§Ø¨ ÙˆØ§Ù„Ù…Ù†ÙŠÙˆ --- */
  :root{
    --bg:#050507; --card:#0f1114; --accent:#c9a36b; --muted:#9aa0a6;
  }
  *{box-sizing:border-box;font-family:system-ui,'Segoe UI',Tahoma,'Noto Sans Arabic',sans-serif}
  body{margin:0;min-height:100vh;background:linear-gradient(180deg,#050507,#0b0c0f);color:#fff;display:flex;align-items:center;justify-content:center;padding:30px}
  .container{width:100%;max-width:1100px}
  header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  header h1{color:var(--accent);font-size:28px;margin:0}
  .adminBtn{background:transparent;border:0;color:#fff;font-size:26px;cursor:pointer;padding:6px 10px;border-radius:8px}
  /* book */
  .bookScene{perspective:2000px;width:100%;height:560px;display:flex;align-items:center;justify-content:center}
  .book{width:760px;height:520px;position:relative;transform-style:preserve-3d}
  .cover{
    position:absolute;width:100%;height:100%;left:0;top:0;
    cursor:pointer;box-shadow:0 40px 80px rgba(0,0,0,0.7);
    transform-origin:left;transition:transform 1s cubic-bezier(.22,.9,.32,1);
    transform-style: preserve-3d;
    z-index: 10;
  }
  .cover-front, .cover-back {
    position: absolute;
    width: 100%; height: 100%;
    backface-visibility: hidden;
    border-radius: 12px;
  }
  .cover-front {
    background: linear-gradient(135deg,#141414,#2b2b2b);
    display: flex; 
    align-items: center; /* ØªØºÙŠÙŠØ± Ù„Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ Ø¹Ù…ÙˆØ¯ÙŠØ§Ù‹ */
    justify-content: center;
    padding: 40px;
    text-align: center; /* Ù„Ø¶Ù…Ø§Ù† Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ ÙÙŠ Ø§Ù„Ù…Ù†ØªØµÙ */
  }
  .cover-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 20px; /* Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø´Ø¹Ø§Ø± ÙˆØ§Ù„ØªÙØ§ØµÙŠÙ„ */
  }
  .cover-front img {
    max-width: 80%; /* ØªØµØºÙŠØ± Ø§Ù„Ø´Ø¹Ø§Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ù„Ø¥ÙØ³Ø§Ø­ Ø§Ù„Ù…Ø¬Ø§Ù„ Ù„Ù„Ù†Øµ */
    max-height: 250px; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ø£Ù‚ØµÙ‰ */
    object-fit: contain;
  }
  .cover-details {
    color: var(--muted);
    font-size: 16px;
  }
  .cover-details p {
    margin: 5px 0;
  }
  .cover-details .phone {
    color: var(--accent);
    font-weight: bold;
    font-size: 18px;
  }
  .cover-back {
    background: #1f1f1f; transform: rotateY(180deg);
  }
  /* Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ÙƒØªØ§Ø¨ØŒ Ø§Ù„ØºÙ„Ø§Ù ÙŠØ®ØªÙÙŠ Ù„Ù„Ø®Ù„Ù */
  .book.open .cover{transform:rotateY(-180deg); z-index: 0;}

  .back-cover {
    position: absolute;
    width: 100%; height: 100%;
    left: 0; top: 0;
    background: linear-gradient(135deg,#141414,#2b2b2b);
    border-radius: 12px;
    z-index: -1; /* ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ø®Ù„Ù Ø¯Ø§Ø¦Ù…Ù‹Ø§ */
  }

  /* Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© */
  .book-rings {
    position: absolute;
    top: 0;
    left: 18px; /* ØªØ¹Ø¯ÙŠÙ„ Ù…ÙˆØ¶Ø¹ Ø§Ù„Ø­Ù„Ù‚Ø§Øª Ø§Ù„Ø°Ù‡Ø¨ÙŠØ© */
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: space-evenly; /* ØªÙˆØ²ÙŠØ¹ Ù…ØªØ³Ø§ÙˆÙ */
    padding: 40px 0; /* Ø­Ø´ÙˆØ© Ø¹Ù„ÙˆÙŠØ© ÙˆØ³ÙÙ„ÙŠØ© */
    z-index: 100; /* ÙÙˆÙ‚ ÙƒÙ„ Ø´ÙŠØ¡ */
    pointer-events: none; /* Ø­ØªÙ‰ Ù„Ø§ ØªØ¹ØªØ±Ø¶ Ø·Ø±ÙŠÙ‚ Ø§Ù„Ù…Ø§ÙˆØ³ */
  }
  .ring {
    width: 30px; /* Ø¹Ø±Ø¶ Ù‚Ø·Ø¹Ø© Ø§Ù„Ø³Ù„Ùƒ */
    height: 8px; /* Ø³Ù…Ø§ÙƒØ© Ø§Ù„Ø³Ù„Ùƒ */
    background: linear-gradient(to right, #a27b41, #f0e2b6, #a27b41); /* ØªØ¯Ø±Ø¬ Ù„ÙˆÙ†ÙŠ Ø°Ù‡Ø¨ÙŠ Ù…Ø¹Ø¯Ù†ÙŠ */
    border-radius: 4px; /* Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ© */
    box-shadow: 1px 1px 5px rgba(0,0,0,0.5); /* Ø¸Ù„ Ù†Ø§Ø¹Ù… Ù„Ø¥Ø¹Ø·Ø§Ø¡ Ø¹Ù…Ù‚ */
    transform: translateX(-24px); /* Ø³Ø­Ø¨ Ø§Ù„Ø­Ù„Ù‚Ø© Ù„Ù„Ø®Ø§Ø±Ø¬ Ù„ØªØ¨Ø¯Ùˆ Ø¨Ø§Ø±Ø²Ø© */
  }

  .page{position:absolute;top:0;left:0;width:100%;height:100%;backface-visibility:hidden;transform-origin:left;transition:transform 900ms cubic-bezier(.22,.9,.32,1);transform-style:preserve-3d; border-radius: 12px;}
  .page-front, .page-back {position:absolute;inset:0;padding:28px;backface-visibility:hidden;display:flex;flex-direction:column}
  .page-front{background:var(--card); box-shadow: inset 7px 0 15px -7px rgba(0,0,0,0.5);} /* Ø¸Ù„ Ø¯Ø§Ø®Ù„ÙŠ Ø£ØºÙ…Ù‚ */
  .page-back{background:var(--card);transform:rotateY(180deg); box-shadow: inset 7px 0 15px -7px rgba(0,0,0,0.5);} /* Ø¸Ù„ Ø¯Ø§Ø®Ù„ÙŠ Ø£ØºÙ…Ù‚ */
  .page.dragging {
    transition: none; /* Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙÙˆØ±ÙŠØ© */
    cursor: grabbing;
  }
  .page h2{margin:0 0 8px 0;color:#c9a36b; position: relative; z-index: 1;} /* z-index to ensure title is above grid */
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;margin-top:10px}
  .card{background:rgba(0,0,0,0.03);padding:10px;border-radius:10px;display:flex;gap:10px;align-items:center}
  .card img{width:120px;height:80px;object-fit:cover;border-radius:8px; background: #333;} /* Ø®Ù„ÙÙŠØ© Ø¯Ø§ÙƒÙ†Ø© Ù„Ù„ØµÙˆØ± Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
  .card .meta{flex:1; color: var(--muted);} /* ØªØºÙŠÙŠØ± Ù„ÙˆÙ† Ø§Ù„ÙˆØµÙ Ù„ÙŠÙƒÙˆÙ† Ø£ÙØªØ­ */
  .price{color:var(--accent);font-weight:700}
  .controls{position:fixed;right:18px;bottom:18px;display:flex;gap:8px}
  /* Admin controls on cards */
  .card-admin-controls{display:none; gap:6px; margin-top:8px;}
  body.admin-mode .card-admin-controls{display:flex;}
  .card-admin-controls button{font-size:12px; padding:4px 8px; border-radius:6px; cursor:pointer; border:0; background:rgba(0,0,0,0.08);}
  .card-admin-controls .delete-btn{background:#ff4d4d;color:#fff}
  .btn{background:rgba(255,255,255,0.06);border:0;padding:10px 12px;border-radius:8px;color:var(--muted);cursor:pointer; user-select: none;}
  /* popup styles */
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:none;align-items:center;justify-content:center;z-index:9999}
  .panel{background:#161616;padding:18px;border-radius:12px;width:360px;box-shadow:0 20px 60px rgba(0,0,0,0.8)}
  input,select,textarea{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:0;background:#222;color:#fff}
  label{color:#ddd;font-size:13px;margin-top:8px;display:block}
  .small{font-size:13px;color:#aaa;margin-top:8px}
  .danger{background:#ff4d4d;color:#111}
  footer.small{margin-top:10px;color:#888;font-size:12px}
  .controls { display: none; } /* Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© */
  @media (max-width:880px){ .book{width:92vw;height:62vh} .grid{grid-template-columns:1fr} .card img{width:90px;height:70px} .panel{width:92vw} }
  /* Helper classes */
  .pos-relative{position:relative}
  .flex-gap{display:flex;gap:8px;margin-top:12px}
  .item-name{font-weight:700; color: #e0e0e0;} /* Ù„ÙˆÙ† ÙØ§ØªØ­ Ù„Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù */
  #pwToggle{position:absolute;left:10px;top:50%;transform:translateY(-50%);cursor:pointer;user-select:none;}
  .spinner { border: 3px solid rgba(255,255,255,0.2); border-top-color: var(--accent); border-radius: 50%; width: 18px; height: 18px; animation: spin 1s linear infinite; display:none; margin: 0 8px; } @keyframes spin { to { transform: rotate(360deg); } }</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Ø£Ø³Ù…Ø§Ùƒ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ</h1>
      <button class="adminBtn" id="adminBtn" title="Ø¥Ø¯Ø§Ø±Ø©">â‹®</button>
    </header>

    <div class="bookScene">
      <div class="book" id="book">
        <div class="cover" id="cover">
          <div class="cover-front">
            <div class="cover-content">
              <img src="images/logo.png" alt="Ø´Ø¹Ø§Ø± Ø£Ø³Ù…Ø§Ùƒ Ø§Ù„Ø±Ø´ÙŠØ¯ÙŠ" />
              <div class="cover-details">
                <p class="address" id="coverAddress">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†...</p>
                <p class="phone" id="coverPhone">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…...</p>
              </div>
            </div>
          </div>
          <div class="cover-back"></div>
        </div>
        <div class="book-rings">
          <div class="ring"></div>
          <div class="ring"></div>
          <div class="ring"></div>
          <div class="ring"></div>
          <div class="ring"></div>
        </div>
        <div class="back-cover"></div>
        <!-- Ø§Ù„ØµÙØ­Ø§Øª Ø³ØªØ¶Ø§Ù Ù‡Ù†Ø§ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨ÙˆØ§Ø³Ø·Ø© JavaScript -->
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="prevBtn">Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
      <button class="btn" id="nextBtn">Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©</button>
    </div>
  </div>

  <!-- Overlay: password prompt -->
  <div class="overlay" id="passwordOverlay">
    <div class="panel">
      <h3>Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
      <div class="pos-relative">
        <input type="password" id="pwInput" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <span id="pwToggle">ğŸ‘ï¸</span>
      </div>
      <label class="small">Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ØªØ­ÙƒÙ… â€” ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù€ hash ÙÙŠ Ø§Ù„ÙƒÙˆØ¯</label>
      <div class="flex-gap">
        <button class="btn" id="pwSubmit">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn" id="pwCancel">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
      <hr style="margin-top:12px;border:none;border-top:1px solid rgba(255,255,255,0.04)">
      <button class="btn" id="forgotPwBtn" style="width:100%; background:transparent; color:#aaa; font-size:13px;">Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</button>
      <div class="small">Ù„Ùˆ Ù†Ø¬Ø­Øª Ø³ØªØ³ØªØ·ÙŠØ¹ Ø±ÙØ¹ ØµÙˆØ± ÙˆØµÙ†Ù Ø¬Ø¯ÙŠØ¯. Ø³ØªØ·Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© Ø¨Ø¹Ø¯ Ø°Ù„Ùƒ Ø§Ù„Ù€ GitHub Token (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©).</div>
    </div>
  </div>

  <!-- Overlay: admin upload -->
  <div class="overlay" id="adminOverlay">
    <div class="panel">
      <h3>Ø¥Ø¶Ø§ÙØ© ØµÙ†Ù Ø¬Ø¯ÙŠØ¯</h3>

      <label>Ø§Ù„ÙØ¦Ø©</label>
      <input id="catInput" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø³Ù…Ø§Ùƒ">

      <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</label>
      <input id="nameInput" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">

      <label>Ø§Ù„Ø³Ø¹Ø±</label>
      <input id="priceInput" placeholder="Ø§Ù„Ø³Ø¹Ø±">

      <label>Ø§Ù„ÙˆØµÙ</label>
      <textarea id="descInput" placeholder="ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>

      <label>Ø§Ù„ØµÙˆØ±Ø© (Ø³ÙŠØªÙ… Ø±ÙØ¹Ù‡Ø§ Ø¥Ù„Ù‰ Ø§Ù„Ø±ÙŠØ¨Ùˆ)</label>
      <input type="file" id="imgInput" accept="image/*">

      <label class="small">Ø£Ø¯Ø®Ù„ GitHub Personal Access Token (Ø³ÙŠÙØ®Ø²Ù† Ù…Ø¤Ù‚ØªÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ ÙÙ‚Ø·)</label>
      <input id="tokenInput" placeholder="ghp_xxx... (Ø£Ø¯Ø®Ù„ Ø§Ù„ØªÙˆÙƒÙ† Ù‡Ù†Ø§ Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©)">

      <div class="flex-gap">
        <button class="btn" id="uploadBtn">Ø¥Ø¶Ø§ÙØ© ÙˆØ±ÙØ¹</button>
        <button class="btn danger" id="closeAdminBtn">Ø¥Ù„ØºØ§Ø¡</button>
        <button class="btn" id="editInfoBtn" style="background:#334;" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†/Ø§Ù„Ù‡Ø§ØªÙ">â„¹ï¸</button>
        <!-- Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± -->
        <button class="btn" id="changePwBtn" style="background:#334;" title="ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">ğŸ”‘</button>
        <button class="btn" id="logoutAdminBtn" style="background:#555;">Ø®Ø±ÙˆØ¬</button>

      </div>

      <footer class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„ØªÙˆÙƒÙ† Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø§Ù„Ø±ÙŠØ¨ÙˆØ› ØµÙ„Ø§Ø­ÙŠØ© repo ÙƒØ§ÙÙŠØ©. Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø­Ù‡ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª GitHub.</footer>
    </div>
  </div>

  <!-- Overlay: edit item -->
  <div class="overlay" id="editOverlay">
    <div class="panel">
      <h3>ØªØ¹Ø¯ÙŠÙ„ ØµÙ†Ù</h3>
      <input type="hidden" id="editIdInput">

      <label>Ø§Ù„ÙØ¦Ø©</label>
      <input id="editCatInput" placeholder="Ù…Ø«Ø§Ù„: Ø§Ø³Ù…Ø§Ùƒ">

      <label>Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</label>
      <input id="editNameInput" placeholder="Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù">

      <label>Ø§Ù„Ø³Ø¹Ø±</label>
      <input id="editPriceInput" placeholder="Ø§Ù„Ø³Ø¹Ø±">

      <label>Ø§Ù„ÙˆØµÙ</label>
      <textarea id="editDescInput" placeholder="ÙˆØµÙ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)"></textarea>

      <div class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© ÙŠØªØ·Ù„Ø¨ Ø­Ø°Ù Ø§Ù„ØµÙ†Ù ÙˆØ¥Ø¶Ø§ÙØªÙ‡ Ù…Ù† Ø¬Ø¯ÙŠØ¯.</div>

      <div class="flex-gap">
        <button class="btn" id="saveEditBtn">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
        <button class="btn danger" id="closeEditBtn">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Overlay: change password -->
  <div class="overlay" id="changePwOverlay">
    <div class="panel">
      <h3>ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
      <div class="small">Ù„ØªØ£Ù…ÙŠÙ† Ø­Ø³Ø§Ø¨ÙƒØŒ Ø³Ù†Ø±Ø³Ù„ Ø±Ù…Ø² ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….</div>
      
      <div class="flex-gap">
        <button class="btn" id="sendCodeBtn">Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</button>
        <div id="sendCodeSpinner" class="spinner"></div>
      </div>

      <label for="verificationCodeInput">Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</label>
      <input id="verificationCodeInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…">

      <label for="newPasswordInput">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
      <input type="password" id="newPasswordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">

      <div class="flex-gap">
        <button class="btn" id="updatePasswordBtn">ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
        <div id="updatePwSpinner" class="spinner"></div>
        <button class="btn danger" id="closeChangePwBtn">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Overlay: forgot password -->
  <div class="overlay" id="forgotPwOverlay">
    <div class="panel">
      <h3>Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
      <div class="small">Ù„Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†ØŒ ÙŠØ¬Ø¨ Ø¥Ø¯Ø®Ø§Ù„ GitHub Token Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù„Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ù…Ù„ÙƒÙŠØ©ØŒ Ø«Ù… Ø·Ù„Ø¨ Ø±Ù…Ø² ØªØ­Ù‚Ù‚ Ø³ÙŠØµÙ„Ùƒ Ø¹Ù„Ù‰ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….</div>

      <label>GitHub Personal Access Token</label>
      <input id="forgotPwTokenInput" placeholder="ghp_xxx...">

      <div class="flex-gap">
        <button class="btn" id="forgotPwSendCodeBtn">Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</button>
        <div id="forgotPwSendCodeSpinner" class="spinner"></div>
      </div>

      <label>Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚</label>
      <input id="forgotPwVerificationCodeInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ù…Ù† ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…">

      <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
      <input type="password" id="forgotPwNewPasswordInput" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©">

      <div class="flex-gap">
        <button class="btn" id="resetPasswordBtn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ†</button>
        <div id="resetPwSpinner" class="spinner"></div>
        <button class="btn danger" id="closeForgotPwBtn">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Overlay: edit info -->
  <div class="overlay" id="infoOverlay">
    <div class="panel">
      <h3>ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„</h3>

      <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
      <input id="infoAddressInput" placeholder="Ù…Ø«Ø§Ù„: ğŸ“ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø´Ø§Ø±Ø¹ ...">

      <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
      <input id="infoPhoneInput" placeholder="Ù…Ø«Ø§Ù„: ğŸ“ Ù„Ù„ØªÙˆØ§ØµÙ„: 012...">

      <div class="flex-gap">
        <button class="btn" id="saveInfoBtn">Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
        <button class="btn danger" id="closeInfoBtn">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Ø¹Ù†ØµØ± Ø§Ù„ØµÙˆØª Ù„Ù‚Ù„Ø¨ Ø§Ù„ØµÙØ­Ø§Øª -->
  <audio id="flipSound" src="audio/page-flip.mp3" preload="auto"></audio>

<script>
/* ================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø±ÙŠØ¨Ù‘Ùˆ ================== */
const GITHUB_OWNER = 'farok6799';
const GITHUB_REPO  = 'Rashedy-Menu';
const GITHUB_BRANCH = 'main'; // Ø£Ùˆ 'master' Ù„Ùˆ Ø¨ØªØ³ØªØ®Ø¯Ù…Ù‡
const MENU_JSON_PATH = 'menu.json';
const INFO_JSON_PATH = 'info.json';
const IMAGES_FOLDER = 'images/';

/* ============ Ø¥Ø¹Ø¯Ø§Ø¯ Ø¨Ø§Ø³ÙˆØ±Ø¯ Ù…Ø®Ø²Ù† Ø¹Ù„Ù‰ Ø´ÙƒÙ„ Ù‡Ø§Ø´ SHA-256 ============
   Ø§Ù„Ù‚ÙŠÙ…Ø© Ù‡Ù†Ø§ ØªÙ…Ø«Ù„ hash('1234') Ø¨Ø§Ù„Ù€ SHA-256. Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯:
   Ø§Ø­Ø³Ø¨ SHA-256 Ù„ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© (ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø£Ø¯ÙŠÙƒ Ø£Ø¯Ø§Ø© Ù„Ùˆ Ø­Ø¨ÙŠØª) ÙˆØºÙŠÙ‘Ø± Ø§Ù„Ù‚ÙŠÙ…Ø©.
   current for '1234' hashed:
*/
const PASSWORD_HASH = '7f41cb340e3b6420e8274fe3e82df0dd965e4428a583299688d6d125cd1c6be3'; // sha256("1234")

/* ================== Ø¹Ù†Ø§ØµØ± DOM ================== */
const adminBtn = document.getElementById('adminBtn');
const passwordOverlay = document.getElementById('passwordOverlay');
const adminOverlay = document.getElementById('adminOverlay');
const editOverlay = document.getElementById('editOverlay');
const infoOverlay = document.getElementById('infoOverlay');
const pwSubmit = document.getElementById('pwSubmit');
const pwCancel = document.getElementById('pwCancel');
const pwInput = document.getElementById('pwInput');
const forgotPwBtn = document.getElementById('forgotPwBtn');
const uploadBtn = document.getElementById('uploadBtn');
const closeAdminBtn = document.getElementById('closeAdminBtn');
const tokenInput = document.getElementById('tokenInput');
const logoutAdminBtn = document.getElementById('logoutAdminBtn'); // Ø²Ø± Ø§Ù„Ø®Ø±ÙˆØ¬
const editInfoBtn = document.getElementById('editInfoBtn');
const changePwBtn = document.getElementById('changePwBtn');

const changePwOverlay = document.getElementById('changePwOverlay');
const sendCodeBtn = document.getElementById('sendCodeBtn');
const sendCodeSpinner = document.getElementById('sendCodeSpinner');
const verificationCodeInput = document.getElementById('verificationCodeInput');
const newPasswordInput = document.getElementById('newPasswordInput');
const updatePasswordBtn = document.getElementById('updatePasswordBtn');
const updatePwSpinner = document.getElementById('updatePwSpinner');
const closeChangePwBtn = document.getElementById('closeChangePwBtn');

const forgotPwOverlay = document.getElementById('forgotPwOverlay');
const forgotPwTokenInput = document.getElementById('forgotPwTokenInput');
const forgotPwSendCodeBtn = document.getElementById('forgotPwSendCodeBtn');
const forgotPwSendCodeSpinner = document.getElementById('forgotPwSendCodeSpinner');
const forgotPwVerificationCodeInput = document.getElementById('forgotPwVerificationCodeInput');
const forgotPwNewPasswordInput = document.getElementById('forgotPwNewPasswordInput');
const resetPasswordBtn = document.getElementById('resetPasswordBtn');
const resetPwSpinner = document.getElementById('resetPwSpinner');
const closeForgotPwBtn = document.getElementById('closeForgotPwBtn');

const nameInput = document.getElementById('nameInput');
const priceInput = document.getElementById('priceInput');
const descInput = document.getElementById('descInput');
const catInput = document.getElementById('catInput');
const imgInput = document.getElementById('imgInput');
const editIdInput = document.getElementById('editIdInput');
const editCatInput = document.getElementById('editCatInput');
const editNameInput = document.getElementById('editNameInput');
const editPriceInput = document.getElementById('editPriceInput');
const editDescInput = document.getElementById('editDescInput');
const saveEditBtn = document.getElementById('saveEditBtn');
const closeEditBtn = document.getElementById('closeEditBtn');
const infoAddressInput = document.getElementById('infoAddressInput');
const infoPhoneInput = document.getElementById('infoPhoneInput');
const saveInfoBtn = document.getElementById('saveInfoBtn');
const closeInfoBtn = document.getElementById('closeInfoBtn');


const bookElement = document.getElementById('book'); // ØªÙ… Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ù† pagesArea Ø¥Ù„Ù‰ book
const cover = document.getElementById('cover');
const book = document.getElementById('book');
const backCover = document.querySelector('.back-cover');
const nextBtn = document.getElementById('nextBtn');
const prevBtn = document.getElementById('prevBtn');
const flipSound = document.getElementById('flipSound');
let hasSingleLastPage = false; // Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© ÙØ±Ø¯ÙŠØ©

let currentPageIndex = 0; // Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§Ù„ØªÙŠ Ù†Ù†Ø¸Ø± Ø¥Ù„ÙŠÙ‡Ø§ (0 Ù‡ÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰)
let pages = []; // array of category pages
let isBookOpen = false;
let isDragging = false;
let dragStartPos = 0;
let draggedPage = null;
let dragDirection = '';

/* ========== ØªØ´ØºÙŠÙ„ ØµÙˆØª Ù‚Ù„Ø¨ Ø§Ù„ØµÙØ­Ø© ========== */
function playFlipSound() {
    if (flipSound) {
        flipSound.currentTime = 0; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØµÙˆØª Ù„Ù„Ø¨Ø¯Ø§ÙŠØ© Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…ØªÙƒØ±Ø±
        flipSound.play().catch(error => {
            // ÙŠØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø®Ø·Ø£ Ø¥Ø°Ø§ Ù…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù‚Ø¨Ù„ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
            // console.log("Playback prevented until user interaction: ", error);
        });
    }
}


/* ========== Ù…Ø³Ø§Ø¹Ø¯Ø©: Ø­Ø³Ø§Ø¨ SHA-256 Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Web Crypto ========= */
async function sha256(text){
  const enc = new TextEncoder();
  const data = enc.encode(text);
  const hashBuffer = await crypto.subtle.digest('SHA-256', data);
  const hashArray = Array.from(new Uint8Array(hashBuffer));
  return hashArray.map(b => b.toString(16).padStart(2,'0')).join('');
}

/* ========== ÙØªØ­/Ø¥ØºÙ„Ø§Ù‚ overlays ========== */
adminBtn.addEventListener('click', ()=> {
  if (!window.crypto || !window.crypto.subtle) {
    alert('Ø®Ø·Ø£: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.\n\nØ§Ù„Ø³Ø¨Ø¨: Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªØ¹Ù…Ù„ Ù…Ù† Ø®Ù„Ø§Ù„ Ø®Ø§Ø¯Ù… ÙˆÙŠØ¨ (localhost Ø£Ùˆ https) ÙˆÙ„ÙŠØ³ ÙƒÙ…Ù„Ù Ù…Ø¨Ø§Ø´Ø±.\n\nØ§Ù„Ø­Ù„: Ø§Ø³ØªØ®Ø¯Ù… Ø¥Ø¶Ø§ÙØ© "Live Server" ÙÙŠ VS Code Ù„ØªØ´ØºÙŠÙ„Ù‡Ø§.');
    return;
  }
  passwordOverlay.style.display = 'flex';
});
pwCancel.addEventListener('click', ()=> passwordOverlay.style.display = 'none');

/* ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© "Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" */
forgotPwBtn.addEventListener('click', () => {
  passwordOverlay.style.display = 'none';
  forgotPwOverlay.style.display = 'flex';
});
closeForgotPwBtn.addEventListener('click', () => {
  forgotPwOverlay.style.display = 'none';
});

/* ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ (Ù…Ù‚Ø§Ø±Ù†Ø© Ù‡Ø§Ø´) */
pwSubmit.addEventListener('click', async ()=> {
  const tryHash = await sha256((pwInput.value || '').trim());
  // --- Ø³Ø·Ø± Ø§Ù„ØªØ´Ø®ÙŠØµ: Ø§Ø·Ø¨Ø¹ Ø§Ù„Ù‡Ø§Ø´ Ø§Ù„Ø°ÙŠ ØªÙ… Ø­Ø³Ø§Ø¨Ù‡ ÙˆØ§Ù„Ù‡Ø§Ø´ Ø§Ù„ØµØ­ÙŠØ­ Ù„Ù„Ù…Ù‚Ø§Ø±Ù†Ø© ---
  console.log('Ø§Ù„Ù‡Ø§Ø´ Ø§Ù„Ø°ÙŠ Ø£Ø¯Ø®Ù„ØªÙ‡:', tryHash, '\nØ§Ù„Ù‡Ø§Ø´ Ø§Ù„ØµØ­ÙŠØ­:', PASSWORD_HASH);
  if(tryHash === PASSWORD_HASH){
    passwordOverlay.style.display = 'none';
    document.body.classList.add('admin-mode'); // ØªÙØ¹ÙŠÙ„ ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±
    alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­. Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ø¸Ø§Ù‡Ø±Ø© Ø§Ù„Ø¢Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£ØµÙ†Ø§Ù.');
    adminOverlay.style.display = 'flex';
    // Ù…Ù…ÙƒÙ† Ø£Ù† Ù†Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† sessionStorage Ù„Ùˆ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¯Ø®Ù„Ù‡ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡
    tokenInput.value = sessionStorage.getItem('GHTOKEN') || '';
  } else {
    alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø·Ø£!');
  }
});

/* Ø¥ØºÙ„Ø§Ù‚ admin */
closeAdminBtn.addEventListener('click', ()=> {
  adminOverlay.style.display = 'none';
});

/* Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ± */
logoutAdminBtn.addEventListener('click', ()=> {
  adminOverlay.style.display = 'none';
  document.body.classList.remove('admin-mode'); // Ø¥Ø²Ø§Ù„Ø© ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±
  tokenInput.value = ''; // Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ø­Ù‚Ù„
  sessionStorage.removeItem('GHTOKEN'); // Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙ† Ù…Ù† Ø§Ù„Ù€ sessionStorage
  alert('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ù…Ù† ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¯ÙŠØ±.');
  renderMenu(); // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ÙŠÙˆ Ù„Ø¥Ø®ÙØ§Ø¡ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„/Ø§Ù„Ø­Ø°Ù
});

/* ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
changePwBtn.addEventListener('click', () => {
  changePwOverlay.style.display = 'flex';
});
closeChangePwBtn.addEventListener('click', () => {
  changePwOverlay.style.display = 'none';
});


/* Ø¥ØºÙ„Ø§Ù‚ edit */
closeEditBtn.addEventListener('click', ()=> {
  editOverlay.style.display = 'none';
});

/* ÙØªØ­ ÙˆØ¥ØºÙ„Ø§Ù‚ Ù„ÙˆØ­Ø© ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª */
editInfoBtn.addEventListener('click', () => {
  loadInfoForEditing(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙŠ Ø§Ù„Ø­Ù‚ÙˆÙ„
  infoOverlay.style.display = 'flex';
});
closeInfoBtn.addEventListener('click', () => {
  infoOverlay.style.display = 'none';
});
/* Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± */
const pwToggle = document.getElementById('pwToggle');
pwToggle.addEventListener('click', () => {
  const isPassword = pwInput.type === 'password';
  pwInput.type = isPassword ? 'text' : 'password';
  pwToggle.textContent = isPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸';
});

/* ================= GitHub API helpers ================= */

/* ØªØ´ØºÙŠÙ„ GitHub Action (workflow_dispatch) */
async function triggerWorkflow(workflowFileName, inputs, tokenOverride = null) {
    const token = tokenOverride || getAuthToken();
    if (!token) {
        throw new Error('Ù…Ø·Ù„ÙˆØ¨ GitHub Token Ù„ØªØ´ØºÙŠÙ„ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.');
    }
    
    const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/actions/workflows/${workflowFileName}/dispatches`;

    const res = await fetch(url, {
        method: 'POST',
        headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            ref: GITHUB_BRANCH,
            inputs: inputs
        })
    });

    if (res.status !== 204) { // 204 No Content is the expected success status
        const t = await res.text();
        if (res.status === 404) {
            throw new Error(`Ø®Ø·Ø£ 404: Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù€ Action. ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù '${workflowFileName}' ÙÙŠ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„ØµØ­ÙŠØ­ (.github/workflows/) Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ.`);
        }
        throw new Error(`Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ù€ Action: ${res.status} - ${t}`);
    }
}

/* ================== Ù…Ù†Ø·Ù‚ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ================== */

function generateRandomCode(length = 10) {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
    let result = '';
    for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
}

sendCodeBtn.addEventListener('click', async () => {
    sendCodeBtn.disabled = true;
    sendCodeSpinner.style.display = 'block';
    try {
        const code = generateRandomCode(10);
        // ØªØ®Ø²ÙŠÙ† Ø§Ù„Ø±Ù…Ø² Ù…Ø¤Ù‚ØªÙ‹Ø§ ÙÙŠ sessionStorage Ù…Ø¹ ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© (5 Ø¯Ù‚Ø§Ø¦Ù‚)
        const expiry = Date.now() + 5 * 60 * 1000;
        sessionStorage.setItem('verificationCode', JSON.stringify({ code, expiry }));

        await triggerWorkflow('send-telegram-code.yml', { verification_code: code });
        alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù…. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ø³Ø§Ø¦Ù„Ùƒ.');
    } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²: ' + err.message);
    } finally {
        sendCodeBtn.disabled = false;
        sendCodeSpinner.style.display = 'none';
    }
});

/* Ù…Ù†Ø·Ù‚ "Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" */
forgotPwSendCodeBtn.addEventListener('click', async () => {
    const token = forgotPwTokenInput.value.trim();
    if (!token) {
        return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ GitHub Token Ø£ÙˆÙ„Ø§Ù‹.');
    }

    forgotPwSendCodeBtn.disabled = true;
    forgotPwSendCodeSpinner.style.display = 'block';
    try {
        const code = generateRandomCode(10);
        const expiry = Date.now() + 5 * 60 * 1000;
        sessionStorage.setItem('verificationCode', JSON.stringify({ code, expiry }));

        await triggerWorkflow('send-telegram-code.yml', { verification_code: code }, token);
        alert('âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ ØªÙŠÙ„ÙŠØ¬Ø±Ø§Ù….');
    } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ù…Ø²: ' + err.message);
    } finally {
        forgotPwSendCodeBtn.disabled = false;
        forgotPwSendCodeSpinner.style.display = 'none';
    }
});

resetPasswordBtn.addEventListener('click', async () => {
    const token = forgotPwTokenInput.value.trim();
    const storedData = JSON.parse(sessionStorage.getItem('verificationCode') || '{}');
    const enteredCode = forgotPwVerificationCodeInput.value.trim();
    const newPassword = forgotPwNewPasswordInput.value.trim();

    if (!token || !enteredCode || !newPassword) return alert('ÙŠØ±Ø¬Ù‰ Ø¥ÙƒÙ…Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„: Ø§Ù„ØªÙˆÙƒÙ†ØŒ Ø§Ù„Ø±Ù…Ø²ØŒ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.');
    if (!storedData.code || Date.now() > storedData.expiry) return alert('Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØªÙ‡. Ø§Ø·Ù„Ø¨ Ø±Ù…Ø²Ù‹Ø§ Ø¬Ø¯ÙŠØ¯Ù‹Ø§.');
    if (enteredCode !== storedData.code) return alert('Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­.');

    resetPasswordBtn.disabled = true;
    resetPwSpinner.style.display = 'block';

    try {
        const newHash = await sha256(newPassword);

        const fileData = await githubGetFile('index.html', token);
        if (!fileData) throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù index.html Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.');

        let fileContent = base64ToUtf8(fileData.content);
        const hashRegex = /(const PASSWORD_HASH = ')([^']+)(';)/;
        if (!hashRegex.test(fileContent)) throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ØªØºÙŠØ± PASSWORD_HASH ÙÙŠ Ø§Ù„ÙƒÙˆØ¯.');
        fileContent = fileContent.replace(hashRegex, `$1${newHash}$3`);

        const newBase64Content = utf8ToBase64(fileContent);
        await githubPutFile('index.html', newBase64Content, 'chore: reset password via forgot password flow', fileData.sha, token);

        alert('âœ… ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
        sessionStorage.removeItem('verificationCode');
        window.location.reload();

    } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙØ§Ø¯Ø­ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ' + err.message);
    } finally {
        resetPasswordBtn.disabled = false;
        resetPwSpinner.style.display = 'none';
    }
});

updatePasswordBtn.addEventListener('click', async () => {
    const storedData = JSON.parse(sessionStorage.getItem('verificationCode') || '{}');
    const enteredCode = verificationCodeInput.value.trim();
    const newPassword = newPasswordInput.value.trim();

    if (!enteredCode || !newPassword) return alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©.');
    if (!storedData.code || Date.now() > storedData.expiry) return alert('Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ø§Ù†ØªÙ‡Øª ØµÙ„Ø§Ø­ÙŠØªÙ‡. ÙŠØ±Ø¬Ù‰ Ø·Ù„Ø¨ Ø±Ù…Ø² Ø¬Ø¯ÙŠØ¯.');
    if (enteredCode !== storedData.code) return alert('Ø±Ù…Ø² Ø§Ù„ØªØ­Ù‚Ù‚ ØºÙŠØ± ØµØ­ÙŠØ­.');

    updatePasswordBtn.disabled = true;
    updatePwSpinner.style.display = 'block';

    try {
        const newHash = await sha256(newPassword);
        const token = getAuthToken();
        if (!token) throw new Error('Ù…Ø·Ù„ÙˆØ¨ GitHub Token Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù„Ù.');

        // 1. Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø­Ø§Ù„ÙŠ
        const fileData = await githubGetFile('index.html');
        if (!fileData) throw new Error('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù index.html Ù…Ù† Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.');

        // 2. ÙÙƒ ØªØ´ÙÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‡Ø§Ø´
        let fileContent = base64ToUtf8(fileData.content);
        const hashRegex = /(const PASSWORD_HASH = ')([^']+)(';)/;
        if (!hashRegex.test(fileContent)) {
            throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ØªØºÙŠØ± PASSWORD_HASH ÙÙŠ Ø§Ù„ÙƒÙˆØ¯. ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù†Ù‡ Ø¨Ù†ÙØ³ Ø§Ù„ØµÙŠØºØ©.');
        }
        fileContent = fileContent.replace(hashRegex, `$1${newHash}$3`);

        // 3. Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ÙÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰ ÙˆØ±ÙØ¹Ù‡
        const newBase64Content = utf8ToBase64(fileContent);
        await githubPutFile('index.html', newBase64Content, 'chore: update password hash', fileData.sha, token);

        alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¢Ù†.');
        sessionStorage.removeItem('verificationCode');
        window.location.reload();

    } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙØ§Ø¯Ø­ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: ' + err.message);
    } finally {
        updatePasswordBtn.disabled = false;
        updatePwSpinner.style.display = 'none';
    }
});

/* Ù‚Ø±Ø§Ø¡Ø© Ù…Ù„Ù Ù…Ù† GitHub (Ù…Ø­ØªÙˆÙ‰ base64 + sha) */
async function githubGetFile(path, tokenOverride = null){
  const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${encodeURIComponent(path)}?ref=${GITHUB_BRANCH}`;
  const headers = {};
  // Ø¥Ø°Ø§ ØªÙ… ØªÙˆÙÙŠØ± ØªÙˆÙƒÙ†ØŒ Ù†Ø³ØªØ®Ø¯Ù…Ù‡. Ù‡Ø°Ø§ Ø¶Ø±ÙˆØ±ÙŠ Ù„Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª Ø§Ù„Ø®Ø§ØµØ©.
  const token = tokenOverride || getAuthToken();
  if (token) {
      headers['Authorization'] = 'token ' + token;
  }
  const res = await fetch(url);
  if(res.status === 200){
    const data = await res.json();
    return data; // { content (base64), sha, path, ... }
  } else if(res.status === 404){
    return null;
  } else {
    const t = await res.text();
    throw new Error('GitHub GET error: ' + res.status + ' - ' + t);
  }
}

/* Ø±ÙØ¹/ØªØ­Ø¯ÙŠØ« Ù…Ù„Ù Ø¥Ù„Ù‰ GitHub (ÙŠØªØ·Ù„Ø¨ ØªÙˆÙƒÙ†) */
async function githubPutFile(path, base64content, message, sha=null, token){
  const url = `https://api.github.com/repos/${GITHUB_OWNER}/${GITHUB_REPO}/contents/${encodeURIComponent(path)}`;
  const body = { message, content: base64content, branch: GITHUB_BRANCH };
  if(sha) body.sha = sha;
  const res = await fetch(url, {
    method:'PUT',
    headers: {
      'Authorization': 'token ' + token,
      'Accept': 'application/vnd.github.v3+json',
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(body)
  });
  if(!res.ok){
    const t = await res.text();
    throw new Error('GitHub PUT error: ' + res.status + ' - ' + t);
  }
  return await res.json();
}

/* ØªØ­Ù…ÙŠÙ„ menu.json Ù…Ù† Ø§Ù„Ø±ÙŠØ¨Ùˆ ÙƒÙ€ object */
async function loadMenuJson(){
  try{
    const file = await githubGetFile(MENU_JSON_PATH);
    if(!file) return [];
    const jsonString = base64ToUtf8(file.content.replace(/\n/g,'')); // ÙÙƒ ØªØ±Ù…ÙŠØ² Base64 Ù…Ø¹ Ø¯Ø¹Ù… UTF-8
    return JSON.parse(jsonString);
  }catch(err){
    console.error(err);
    return [];
  }
}

/* ØªØ­Ù…ÙŠÙ„ info.json ÙˆØ¹Ø±Ø¶Ù‡ */
async function loadAndRenderInfo() {
    const coverAddress = document.getElementById('coverAddress');
    const coverPhone = document.getElementById('coverPhone');
    try {
        const file = await githubGetFile(INFO_JSON_PATH);
        if (!file) throw new Error('Ù…Ù„Ù Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª info.json ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');
        const info = JSON.parse(base64ToUtf8(file.content.replace(/\n/g, '')));
        coverAddress.textContent = info.address || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù†ÙˆØ§Ù†';
        coverPhone.textContent = info.phone || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… Ù‡Ø§ØªÙ';
    } catch (err) {
        console.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„:', err);
        coverAddress.textContent = 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†';
        coverPhone.textContent = 'Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ù‚Ù…';
    }
}

function createPageSideContent(category, items) {
    let gridHtml = '';
    for (const it of items) {
        const imgUrl = it.image || '';
        gridHtml += `
            <div class="card">
                <img 
                    src="${imgUrl}" 
                    alt="${escapeHtml(it.name)}" 
                    loading="lazy" 
                    onerror="this.style.display='none'"
                >
                <div class="meta">
                    <div class="item-name">${escapeHtml(it.name)}</div>
                    <div style="color:#888;font-size:13px">${escapeHtml(it.desc||'')}</div>
                    <div class="price">${escapeHtml(it.price)}</div>
                    <div class="card-admin-controls">
                        <button class="edit-btn" data-id="${escapeHtml(it.addedAt)}">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="delete-btn" data-id="${escapeHtml(it.addedAt)}">Ø­Ø°Ù</button>
                    </div>
                </div>
            </div>
        `;
    }
    return `
        <h2>${escapeHtml(category)}</h2>
        <div class="grid">${gridHtml}</div>
    `;
}

/* Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ÙŠÙˆ: Ù†Ù‚Ø³Ù… Ø­Ø³Ø¨ Ø§Ù„ÙØ¦Ø§Øª */
async function renderMenu(){
  loadAndRenderInfo(); // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù‡Ø§ØªÙ
  // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù‚Ø¨Ù„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ù†Ø§Ø¡
  bookElement.querySelectorAll('.page').forEach(p => p.remove());
  pages = [];

  const menu = await loadMenuJson();
  
  const categories = menu.reduce((acc, item) => {
      const category = item.category || 'ØºÙŠØ± Ù…ØµÙ†Ù';
      if (!acc[category]) acc[category] = [];
      acc[category].push(item);
      return acc;
  }, {});
  const categoryEntries = Object.entries(categories);

  for (let i = 0; i < categoryEntries.length; i += 2) {
      const page = document.createElement('div');
      page.className = 'page';

      const [frontCat, frontItems] = categoryEntries[i];
      const frontContent = createPageSideContent(frontCat, frontItems);
      
      const backEntry = categoryEntries[i + 1];
      const backContent = backEntry ? createPageSideContent(backEntry[0], backEntry[1]) : '';

      page.innerHTML = `<div class="page-front">${frontContent}</div><div class="page-back">${backContent}</div>`;
      if (!backContent) hasSingleLastPage = true; // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ù…Ø­ØªÙˆÙ‰ Ø®Ù„ÙÙŠØŒ ÙÙ‡Ø°Ù‡ ØµÙØ­Ø© ÙØ±Ø¯ÙŠØ©
      bookElement.appendChild(page); // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙØ­Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙƒØªØ§Ø¨
      pages.push(page);
  }
  // Ø¥Ø¶Ø§ÙØ© event listeners Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
  addAdminActionListeners();

  // Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ Ù„Ùˆ Ù…ÙÙŠØ´ ØµÙØ­Ø§Øª Ø§Ø¨Ù‚Ù Ø§Ù„ØºÙ„Ø§Ù Ø¸Ø§Ù‡Ø± ÙÙ‚Ø·
  currentPageIndex = 0;
  applyFlipState();
}

/* ================ Ù…Ù†Ø·Ù‚ Ø³Ø­Ø¨ ÙˆØªÙ‚Ù„ÙŠØ¨ Ø§Ù„ØµÙØ­Ø§Øª ================ */

// ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙØ­Ø© Ø§Ù„ØªÙŠ ÙŠØªÙ… Ø³Ø­Ø¨Ù‡Ø§ ÙˆØ§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³Ø­Ø¨
function handleDragStart(e) {
    if (!isBookOpen || isDragging || !pages.length) return;

    const rect = bookElement.getBoundingClientRect();
    const clickX = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;

    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ù†ØµÙ Ø§Ù„Ø£ÙŠØ³Ø± Ù„Ù„ÙƒØªØ§Ø¨ (Ù„Ù„Ø®Ù„Ù)
    if (clickX < rect.width / 2) {
        if (currentPageIndex <= 0) return; // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„Ø±Ø¬ÙˆØ¹ Ù…Ù† Ø§Ù„ØºÙ„Ø§Ù
        dragDirection = 'prev';
        draggedPage = pages[currentPageIndex - 1]; // Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Ù‡ÙŠ Ø¢Ø®Ø± ØµÙØ­Ø© Ù…Ù‚Ù„ÙˆØ¨Ø©
    } 
    // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ù†ØµÙ Ø§Ù„Ø£ÙŠÙ…Ù† Ù„Ù„ÙƒØªØ§Ø¨ (Ù„Ù„Ø£Ù…Ø§Ù…)
    else {
        if (currentPageIndex >= pages.length) return; // Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        dragDirection = 'next';
        draggedPage = pages[currentPageIndex]; // Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© Ù‡ÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    }

    isDragging = true;
    dragStartPos = e.touches ? e.touches[0].clientX : e.clientX;
    draggedPage.classList.add('dragging');
    e.preventDefault();

    window.addEventListener('mousemove', handleDragMove);
    window.addEventListener('touchmove', handleDragMove);
    window.addEventListener('mouseup', handleDragEnd);
    window.addEventListener('touchend', handleDragEnd);
}

// ØªØ­Ø±ÙŠÙƒ Ø§Ù„ØµÙØ­Ø© Ø¨ØµØ±ÙŠÙ‹Ø§ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨
function handleDragMove(e) {
    if (!isDragging || !draggedPage) return;

    const currentX = e.touches ? e.touches[0].clientX : e.clientX;
    const deltaX = currentX - dragStartPos;

    if (dragDirection === 'next') {
        const rotation = Math.max(-180, Math.min(0, (deltaX / draggedPage.offsetWidth) * 180));
        draggedPage.style.transform = `rotateY(${rotation}deg)`;
    } else if (dragDirection === 'prev') {
        const rotation = Math.max(-180, Math.min(0, -180 + (deltaX / draggedPage.offsetWidth) * 180));
        draggedPage.style.transform = `rotateY(${rotation}deg)`;
    }
}

// Ø¥Ù†Ù‡Ø§Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø³Ø­Ø¨ ÙˆØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø³ÙŠØªÙ… Ø§Ù„ØªÙ‚Ù„ÙŠØ¨
function handleDragEnd(e) {
    if (!isDragging || !draggedPage) return;

    isDragging = false;
    draggedPage.classList.remove('dragging');

    const currentX = e.changedTouches ? e.changedTouches[0].clientX : e.clientX;
    const deltaX = currentX - dragStartPos;
    const flipThreshold = draggedPage.offsetWidth / 3; // ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ³Ø­Ø¨ Ø«Ù„Ø« Ø§Ù„ØµÙØ­Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„

    if (dragDirection === 'next' && deltaX < -flipThreshold) {
        // Ø£ÙƒÙ…Ù„ Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        playFlipSound();
        nextBtn.click();
    } else if (dragDirection === 'prev' && deltaX > flipThreshold) {
        // Ø£ÙƒÙ…Ù„ Ø§Ù„ØªÙ‚Ù„ÙŠØ¨ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        playFlipSound();
        prevBtn.click();
    } else {
        // Ù„Ù… ÙŠØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ØŒ Ø£Ø¹Ø¯ Ø§Ù„ØµÙØ­Ø© Ù„Ù…ÙƒØ§Ù†Ù‡Ø§
        applyFlipState();
    }

    // ØªÙ†Ø¸ÙŠÙ
    draggedPage = null;
    dragDirection = '';
    window.removeEventListener('mousemove', handleDragMove);
    window.removeEventListener('touchmove', handleDragMove);
    window.removeEventListener('mouseup', handleDragEnd);
    window.removeEventListener('touchend', handleDragEnd);
}

bookElement.addEventListener('mousedown', handleDragStart);
bookElement.addEventListener('touchstart', handleDragStart, { passive: false });


/* ØªØ¹Ø§Ø¨ÙŠØ± Ù…Ø³Ø§Ø¹Ø¯Ø© */
function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' })[c]); }

/* ØªØ­ÙƒÙ… Ø¨Ø­Ø§Ù„Ø© Ø§Ù„ÙƒØªØ§Ø¨ ÙˆØ§Ù„ØµÙØ­Ø§Øª (ØªÙ‚Ù„ÙŠØ¨) */
function applyFlipState(){
  if (!isBookOpen) {
    book.classList.remove('open');
    book.classList.remove('end'); // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„ØªÙ‡ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    // Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ÙƒØªØ§Ø¨ØŒ ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø§Ø¯Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙØ­Ø§Øª Ø¥Ù„Ù‰ Ø­Ø§Ù„ØªÙ‡Ø§ Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    pages.forEach((page, i) => {
      page.style.transform = 'rotateY(0deg)';
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ z-index Ù„ØªØ¨Ø¯Ùˆ Ø§Ù„ØµÙØ­Ø§Øª Ù…ÙƒØ¯Ø³Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­ Ø¹Ù†Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
      page.style.zIndex = pages.length - i; 
    });
    return;
  }

  // Ù„Ù… Ù†Ø¹Ø¯ Ø¨Ø­Ø§Ø¬Ø© Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© .end
  book.classList.add('open');

  const total = pages.length;
  pages.forEach((page, i) => {
    // Ø§Ù„ØµÙØ­Ø© ØªÙÙ‚Ù„Ø¨ Ø¥Ø°Ø§ ÙƒØ§Ù† ØªØ±ØªÙŠØ¨Ù‡Ø§ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
    const isFlipped = i < currentPageIndex;

    page.style.transform = isFlipped ? 'rotateY(-180deg)' : 'rotateY(0deg)';
    
    // Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ù‚Ù„ÙˆØ¨Ø© ØªØ£Ø®Ø° ØªØ±ØªÙŠØ¨Ù‹Ø§ ØªØµØ§Ø¹Ø¯ÙŠÙ‹Ø§ (z-index: 1, 2, 3...).
    // Ø§Ù„ØµÙØ­Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ù‚Ù„ÙˆØ¨Ø© ØªØ£Ø®Ø° ØªØ±ØªÙŠØ¨Ù‹Ø§ ØªÙ†Ø§Ø²Ù„ÙŠÙ‹Ø§ (z-index: 5, 4, 3...).
    // Ù‡Ø°Ø§ ÙŠØ¶Ù…Ù† Ø£Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø¯Ø§Ø¦Ù…Ù‹Ø§ ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰.
    page.style.zIndex = isFlipped ? i + 1 : total - i;
  });
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ§Ù„ÙŠ / Ø§Ù„Ø³Ø§Ø¨Ù‚ */
nextBtn.addEventListener('click', ()=> {
  if (!isBookOpen || currentPageIndex >= pages.length) return; // Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª
  playFlipSound();
  currentPageIndex++;
  applyFlipState();
});
prevBtn.addEventListener('click', ()=> {
  if (!isBookOpen) return;
  playFlipSound();
  if (currentPageIndex > 0) {
    currentPageIndex--;
  } else { // Ù„Ùˆ ÙƒÙ†Ø§ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰ ÙˆÙ†Ø¶ØºØ· "Ø³Ø§Ø¨Ù‚"ØŒ Ù†ØºÙ„Ù‚ Ø§Ù„ÙƒØªØ§Ø¨
    isBookOpen = false;
  }
  applyFlipState();
});
cover.addEventListener('click', ()=> {
  if (isBookOpen) return; // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ù‹Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ù…ÙØªÙˆØ­Ù‹Ø§ Ø¨Ø§Ù„ÙØ¹Ù„
  playFlipSound();
  isBookOpen = true;
  applyFlipState();
});
cover.querySelector('.cover-back').addEventListener('click', (event) => {
    if (!isBookOpen) return;
    event.stopPropagation(); // Prevent click from propagating to the cover element
    currentPageIndex = 0; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©
    isBookOpen = false;
    applyFlipState();
    playFlipSound();
});
backCover.addEventListener('click', () => {
    if (!isBookOpen) return; // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ù‹Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙƒØªØ§Ø¨ Ù…ØºÙ„Ù‚Ù‹Ø§
    currentPageIndex = 0; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ† Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©
    isBookOpen = false;
    applyFlipState();
    playFlipSound();
});

/* ================= Helper Functions ================= */
function getAuthToken() {
    const token = tokenInput.value.trim() || sessionStorage.getItem('GHTOKEN');
    if (token) sessionStorage.setItem('GHTOKEN', token);
    return token;
}
/* ============== Ø±ÙØ¹ ØµÙˆØ±Ø© ÙˆØ­Ø¯Ø« menu.json ============== */
async function uploadItem(){
  const name = nameInput.value.trim();
  const price = priceInput.value.trim();
  const desc = descInput.value.trim();
  const category = (catInput.value.trim() || 'ØºÙŠØ± Ù…ØµÙ†Ù');
  const file = imgInput.files[0];
  const token = getAuthToken();

  if(!name || !price || !file){
    return alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§ÙƒÙ…Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø³Ø¹Ø± ÙˆØ§Ø®ØªØ± ØµÙˆØ±Ø©.');
  }
  if(!token){
    return alert('Ù…Ø·Ù„ÙˆØ¨ GitHub Token Ù„Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„Ù‡ ÙÙŠ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….');
  }

  try{
    // 1) Ù†Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ images/<filename>
    const filename = makeSafeFilename(file.name);
    const targetPath = IMAGES_FOLDER + filename;

    // Ø§Ù‚Ø±Ø£ Ø§Ù„Ù…Ù„Ù ÙƒÙ€ base64
    const base64 = await fileToBase64(file); // returns base64 string without data:...
    await githubPutFile(targetPath, base64, `Add image ${filename}`, null, token);
    // Ø¨Ø¹Ø¯ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ù†ÙƒÙˆÙ‘Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø®Ø§Ù… Ù„Ù„ØµÙˆØ±Ø©:
    const rawUrl = `https://raw.githubusercontent.com/${GITHUB_OWNER}/${GITHUB_REPO}/${GITHUB_BRANCH}/${targetPath}`;

    // 2) Ù†Ù‚Ø±Ø£ menu.json Ø§Ù„Ø­Ø§Ù„ÙŠ
    const existingFile = await githubGetFile(MENU_JSON_PATH);
    let menu = [];
    let sha = null;
    if(existingFile && existingFile.content){ // ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ù„Ù ÙˆÙ…Ø­ØªÙˆØ§Ù‡
      sha = existingFile.sha;
      menu = JSON.parse(base64ToUtf8(existingFile.content.replace(/\n/g,'')));
    } else {
      menu = [];
    }

    // 3) Ù†Ø¶ÙŠÙ Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯
    const newItem = { name, price, desc, category, image: rawUrl, addedAt: new Date().toISOString() };
    menu.push(newItem);

    // 4) Ù†Ø±ÙØ¹ menu.json Ù…Ø¹ sha Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯
    const jsonString = JSON.stringify(menu, null, 2);
    await githubPutFile(MENU_JSON_PATH, utf8ToBase64(jsonString), `Add menu item ${name}`, sha, token);

    alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­ Ø¥Ù„Ù‰ Ø§Ù„Ø±ÙŠØ¨Ùˆ!');
    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø­Ù‚ÙˆÙ„
    nameInput.value = priceInput.value = descInput.value = '';
    catInput.value = '';
    imgInput.value = '';
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶
    await renderMenu();

  }catch(err){
    console.error(err);
    alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø±ÙØ¹: ' + err.message);
  }
}

/* ================ ØªØ¹Ø¯ÙŠÙ„ ÙˆØ­Ø°Ù Ø§Ù„Ø£ØµÙ†Ø§Ù ================ */

function addAdminActionListeners() {
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', handleEditClick);
    });
    document.querySelectorAll('.delete-btn').forEach(btn => {
        btn.addEventListener('click', handleDeleteClick);
    });
}

async function handleEditClick(event) {
    const itemId = event.target.dataset.id;
    const menu = await loadMenuJson();
    const itemToEdit = menu.find(item => item.addedAt === itemId);

    if (!itemToEdit) {
        alert('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ù!');
        return;
    }

    // Ù…Ù„Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    editIdInput.value = itemToEdit.addedAt;
    editCatInput.value = itemToEdit.category || '';
    editNameInput.value = itemToEdit.name || '';
    editPriceInput.value = itemToEdit.price || '';
    editDescInput.value = itemToEdit.desc || '';

    editOverlay.style.display = 'flex';
}

async function handleDeleteClick(event) {
    const itemId = event.target.dataset.id;
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø±ØºØ¨ØªÙƒ ÙÙŠ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµÙ†ÙØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.')) {
        return;
    }

    const token = getAuthToken();
    if (!token) {
        return alert('Ù…Ø·Ù„ÙˆØ¨ GitHub Token Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø§Ù„Ø­Ø°Ù. ÙŠØ±Ø¬Ù‰ ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ¥Ø¯Ø®Ø§Ù„Ù‡.');
    }
    
    try {
        const existingFile = await githubGetFile(MENU_JSON_PATH);
        if (!existingFile) throw new Error('Ù…Ù„Ù Ø§Ù„Ù…Ù†ÙŠÙˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');

        let menu = JSON.parse(base64ToUtf8(existingFile.content.replace(/\n/g, '')));
        const updatedMenu = menu.filter(item => item.addedAt !== itemId);

        if (menu.length === updatedMenu.length) {
            throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ù Ø§Ù„Ù…Ø±Ø§Ø¯ Ø­Ø°ÙÙ‡.');
        }

        const jsonString = JSON.stringify(updatedMenu, null, 2);
        await githubPutFile(MENU_JSON_PATH, utf8ToBase64(jsonString), `Delete menu item ${itemId}`, existingFile.sha, token);

        alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„ØµÙ†Ù Ø¨Ù†Ø¬Ø§Ø­.');
        await renderMenu();

    } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: ' + err.message);
    }
}

saveEditBtn.addEventListener('click', async () => {
    const itemId = editIdInput.value;
    const token = getAuthToken();
    if (!token) {
        return alert('Ù…Ø·Ù„ÙˆØ¨ GitHub Token Ù„Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª. ÙŠØ±Ø¬Ù‰ ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ¥Ø¯Ø®Ø§Ù„Ù‡.');
    }
    
    try {
        const existingFile = await githubGetFile(MENU_JSON_PATH);
        if (!existingFile) throw new Error('Ù…Ù„Ù Ø§Ù„Ù…Ù†ÙŠÙˆ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');

        let menu = JSON.parse(base64ToUtf8(existingFile.content.replace(/\n/g, '')));
        const itemIndex = menu.findIndex(item => item.addedAt === itemId);
        if (itemIndex === -1) throw new Error('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„ØµÙ†Ù.');

        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØµÙ†Ù
        menu[itemIndex].category = editCatInput.value.trim();
        menu[itemIndex].name = editNameInput.value.trim();
        menu[itemIndex].price = editPriceInput.value.trim();
        menu[itemIndex].desc = editDescInput.value.trim();

        const jsonString = JSON.stringify(menu, null, 2);
        await githubPutFile(MENU_JSON_PATH, utf8ToBase64(jsonString), `Edit menu item ${menu[itemIndex].name}`, existingFile.sha, token);

        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.');
        editOverlay.style.display = 'none';
        await renderMenu();

    } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª: ' + err.message);
    }
});

/* ================ ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„ ================ */

async function loadInfoForEditing() {
    try {
        const file = await githubGetFile(INFO_JSON_PATH);
        if (!file) return; // Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ù‹Ø§ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ù„Ù Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
        const info = JSON.parse(base64ToUtf8(file.content.replace(/\n/g, '')));
        infoAddressInput.value = info.address || '';
        infoPhoneInput.value = info.phone || '';
    } catch (err) {
        console.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù„Ù„ØªØ¹Ø¯ÙŠÙ„:', err);
        alert('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„.');
    }
}

saveInfoBtn.addEventListener('click', async () => {
    const token = getAuthToken();
    if (!token) {
        return alert('Ù…Ø·Ù„ÙˆØ¨ GitHub Token Ù„Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª.');
    }

    const newAddress = infoAddressInput.value.trim();
    const newPhone = infoPhoneInput.value.trim();

    try {
        const existingFile = await githubGetFile(INFO_JSON_PATH);
        const sha = existingFile ? existingFile.sha : null;

        const newInfo = { address: newAddress, phone: newPhone };
        const jsonString = JSON.stringify(newInfo, null, 2);
        const base64Content = utf8ToBase64(jsonString);

        await githubPutFile(INFO_JSON_PATH, base64Content, 'feat: update contact info', sha, token);

        alert('âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ù†Ø¬Ø§Ø­.');
        infoOverlay.style.display = 'none';
        await loadAndRenderInfo(); // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„ØºÙ„Ø§Ù
    } catch (err) {
        console.error('Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªÙˆØ§ØµÙ„:', err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­ÙØ¸ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª: ' + err.message);
    }
});
/* ØªØ­ÙˆÙŠÙ„ Ù†Øµ UTF-8 Ø¥Ù„Ù‰ Base64 (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©) */
function utf8ToBase64(str) {
  const encoder = new TextEncoder();
  const data = encoder.encode(str);
  let binary = '';
  for (let i = 0; i < data.length; i++) {
    binary += String.fromCharCode(data[i]);
  }
  return btoa(binary);
}

/* ØªØ­ÙˆÙŠÙ„ Base64 Ø¥Ù„Ù‰ Ù†Øµ UTF-8 (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø­Ø¯ÙŠØ«Ø©) */
function base64ToUtf8(b64) {
  const binary = atob(b64);
  const bytes = new Uint8Array(binary.length);
  for (let i = 0; i < binary.length; i++) {
    bytes[i] = binary.charCodeAt(i);
  }
  const decoder = new TextDecoder('utf-8');
  return decoder.decode(bytes);
}


/* ØªØ­ÙˆÙŠÙ„ Ù…Ù„Ù Ø¥Ù„Ù‰ base64 (Ø¨Ø¯ÙˆÙ† data:prefix) */
function fileToBase64(file){
  return new Promise((res, rej)=>{
    const reader = new FileReader();
    reader.onload = ()=> {
      const result = reader.result;
      // result Ù…Ø«Ø§Ù„: "data:image/png;base64,...."
      const comma = result.indexOf(',');
      res(result.substring(comma+1));
    };
    reader.onerror = e=> rej(e);
    reader.readAsDataURL(file);
  });
}

/* sanitize filename */
function makeSafeFilename(name){
  // Ø¥Ø¶Ø§ÙØ© ÙˆÙ‚Øª Ù„ØªØ¬Ù†Ø¨ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙˆÙ‚ Ù…Ù„Ù Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù…
  const ts = Date.now();
  const clean = name.replace(/[^a-zA-Z0-9\.\-_]/g, '_');
  return `${ts}_${clean}`;
}

/* ================ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ ================ */
renderMenu();

/* ================ Ø£Ø­Ø¯Ø§Ø« Ø±ÙØ¹ ================ */
uploadBtn.addEventListener('click', uploadItem);

/* ========= Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±: Ù…Ø³Ø­ Token Ù…Ø¤Ù‚Øª Ù…Ù† sessionStorage ========= */
window.clearToken = ()=> { sessionStorage.removeItem('GHTOKEN'); alert('Token cleared from sessionStorage'); }

/* ========= Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: Ù„Ùˆ Ø¹Ø§ÙŠØ² ØªØºÙŠØ± Ø§Ù„Ø¨Ø§Ø³ÙˆØ±Ø¯ =========
   - Ø§Ø­Ø³Ø¨ sha256 Ù„ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ window.sha256('newpass') ÙÙŠ console)
   - Ø¶ÙØ¹ Ø§Ù„Ù†Ø§ØªØ¬ Ù…ÙƒØ§Ù† PASSWORD_HASH ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„ÙƒÙˆØ¯
*/

</script>
</body>
</html>
